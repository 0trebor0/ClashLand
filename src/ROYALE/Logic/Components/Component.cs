using CRepublic.Royale.Extensions.List;
using CRepublic.Royale.Logic.Slots.Items;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace CRepublic.Royale.Logic.Components
{
    internal class Component
    {
        internal Player Player;

        internal Component(Player Player)
        {
            this.Player = Player;
        }

        internal byte[] ToBytes
        {
            get
            {
                int TimeStamp = (int)DateTime.UtcNow.Subtract(new DateTime(1970, 1, 1)).TotalSeconds;

                List<byte> _Packet = new List<byte>();

                _Packet.AddLong(this.Player.UserId);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(1698340);
                _Packet.AddVInt(1727920);

                _Packet.AddVInt(TimeStamp);

                _Packet.AddVInt(0);
                _Packet.AddVInt(1);
                {
                    _Packet.AddVInt(8);

                    foreach (Card _Card in this.Player.Decks.GetRange(0, 8))
                    {
                        _Packet.AddVInt(_Card.GId);
                    }
                }

                _Packet.Add(255); // Deck Thingy

                _Packet.AddRange(this.Player.Decks.ToBytes());

                _Packet.AddVInt(this.Player.Decks.Count - 8);

                foreach (Card _Card in this.Player.Decks.Skip(8))
                {
                    _Packet.AddVInt(_Card.ID);
                    _Packet.AddVInt(_Card.Level);
                    _Packet.AddVInt(0);
                    _Packet.AddVInt(_Card.Count);
                    _Packet.AddVInt(0);
                    _Packet.AddVInt(0);
                    _Packet.AddVInt(_Card.New);
                }

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);
                _Packet.AddVInt(0);

                _Packet.AddVInt(63);
                _Packet.AddVInt(63);

                _Packet.AddVInt(TimeStamp);

                _Packet.AddVInt(1);

                _Packet.AddVInt(0);

                _Packet.AddVInt(5);

                _Packet.AddVInt(34);

                #region Events

                _Packet.AddString("Musketeer Stack Offer");

                _Packet.AddVInt(1); // Unknown

                _Packet.AddHexa("909CB98F0B"); // Start

                _Packet.AddHexa("90E2C38F0B"); // End

                _Packet.AddHexa("909CB98F0B"); // Remaining

                _Packet.AddHexa("0000000000000000");

                _Packet.AddString("Musketeer Stack Offer");

                _Packet.AddHexa("000002CD7B225469746C65223A224D75736B6574656572204F6666657221222C225375627469746C65223A2254686973206C696D69746564206F666665722069732061204F4E452074696D6520707572636861736521222C2253686F704F6666657273223A5B7B2252657761726473223A5B7B2254797065223A227370656C6C222C22416D6F756E74223A31322C225370656C6C223A224D75736B6574656572227D5D2C225469746C65223A224D75736B6574656572222C22496D616765223A7B2250617468223A225C2F62656235343964373538333437623836663832386538363633646564333335665F73686F705F6D75736B65746565725F737461636B5F30312E706E67222C22436865636B73756D223A226265623534396437353833343762383666383238653836363364656433333566222C2246696C65223A2273686F705F6D75736B65746565725F737461636B5F30312E706E67227D2C22436F737454797065223A2267656D73222C22436F7374223A35302C2254656D706C617465223A2273686F705F6974656D325F6E6F5F74657874227D2C7B2252657761726473223A5B7B2254797065223A227370656C6C222C22416D6F756E74223A3130302C225370656C6C223A224D75736B6574656572227D5D2C225469746C65223A224D75736B6574656572222C22496D616765223A7B2250617468223A225C2F61373565316264353638323861316461623130386662613166386636363165645F73686F705F6D75736B65746565725F737461636B5F30322E706E67222C22436865636B73756D223A226137356531626435363832386131646162313038666261316638663636316564222C2246696C65223A2273686F705F6D75736B65746565725F737461636B5F30322E706E67227D2C22436F737454797065223A2267656D73222C22436F7374223A3338302C2254656D706C617465223A2273686F705F6974656D325F6E6F5F74657874227D5D7D23000000184D75736B65746565722043617264204368616C6C656E676502909CB98F0B90E2C38F0B909CB98F0B0000000000000000000000184D75736B65746565722043617264204368616C6C656E67650000037D7B2247616D654D6F6465223A224361726452656C656173654472616674222C225469746C65223A224D75736B65746565722043617264204368616C6C656E6765222C224A6F696E436F7374223A31302C224A6F696E436F73745265736F75726365223A2247656D73222C224D61784C6F73736573223A332C2252657761726473223A5B7B22476F6C64223A3133302C224361726473223A327D2C7B22476F6C64223A3138302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A332C225370656C6C223A224D75736B6574656572227D2C224361726473223A337D2C7B22476F6C64223A3234302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A352C225370656C6C223A224D75736B6574656572227D2C224361726473223A357D2C7B22476F6C64223A3331302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A382C225370656C6C223A224D75736B6574656572227D2C224361726473223A387D5D2C2249636F6E4578706F72744E616D65223A2269636F6E5F746F75726E616D656E745F636172645F72656C65617365222C2257696E49636F6E4578706F72744E616D65223A22746F75726E616D656E745F6F70656E5F77696E735F62616467655F6472616674222C224172656E61223A22416C6C222C224D696C6573746F6E65486967686C69676874496E5549223A332C225375627469746C65223A2257696E204D75736B65746565727321222C224465736372697074696F6E223A2257696E204D75736B657465657273207468726F756768206F6E652074696D65207265776172647320616E6420636F6D706C65746520746869732043617264204368616C6C656E676520617420332077696E7321222C2253746172744E6F74696669636174696F6E223A22506C6179203234682043617264204368616C6C656E676520616E6420636865636B207468652053686F7020666F72206361726420737461636B7321222C22456E644E6F74696669636174696F6E223A2254776F20686F757273206C65667420746F20706C61792043617264204368616C6C656E676520616E642067657420746865206361726420737461636B732066726F6D207468652073686F7021222C22436172645468656D65223A224D75736B6574656572222C224672656550617373223A307D24000000214865616C20436172642052656C65617365204368616C6C656E67652046696E616C02B0A197900BB0F3B6900BB089ED8F0B0000000000000000000000214865616C20436172642052656C65617365204368616C6C656E67652046696E616C0000050F7B2247616D654D6F6465223A224361726452656C656173654472616674222C225469746C65223A224865616C204472616674204368616C6C656E6765222C224672656550617373223A312C224A6F696E436F7374223A3130302C224A6F696E436F73745265736F75726365223A2247656D73222C224D61784C6F73736573223A332C2252657761726473223A5B7B22476F6C64223A3730302C224361726473223A31307D2C7B22476F6C64223A3935302C224361726473223A31357D2C7B22476F6C64223A313235302C224361726473223A32357D2C7B22476F6C64223A313630302C224361726473223A34327D2C7B22476F6C64223A323030302C224D696C6573746F6E65223A7B2254797065223A22476F6C64222C22416D6F756E74223A323530307D2C224361726473223A36357D2C7B22476F6C64223A323530302C224361726473223A39327D2C7B22476F6C64223A333130302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A31302C225370656C6C223A224865616C227D2C224361726473223A3132357D2C7B22476F6C64223A333830302C224361726473223A3136357D2C7B22476F6C64223A343635302C224D696C6573746F6E65223A7B224368657374223A224769616E745F3C63757272656E745F6172656E613E222C2254797065223A224368657374227D2C224361726473223A3231307D2C7B22476F6C64223A373130302C224361726473223A3236357D2C7B22476F6C64223A383735302C224D696C6573746F6E65223A7B2254797065223A22476F6C64222C22416D6F756E74223A32353030307D2C224361726473223A3333357D2C7B22476F6C64223A313633302C224361726473223A3433307D2C7B22476F6C64223A31313030302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A3130302C225370656C6C223A224865616C227D2C224361726473223A3535307D5D2C2249636F6E4578706F72744E616D65223A2269636F6E5F746F75726E616D656E745F636172645F72656C65617365222C22436172645468656D65223A224865616C222C2257696E49636F6E4578706F72744E616D65223A22746F75726E616D656E745F6F70656E5F77696E735F62616467655F6472616674222C224172656E61223A22416C6C222C225375627469746C65223A22556E6C6F636B2061204E6577204361726421222C224465736372697074696F6E223A225069636B203420636172647320616E64207265636569766520342066726F6D20796F7572206F70706F6E656E743B206F6E65206F6620796F752077696C6C2067657420746F20706C6179207769746820746865204865616C207370656C6C2120436F6C6C656374206F6E652074696D65207265776172647320617320796F752070726F677265737320616E6420756E6C6F636B2074686973206E65772063617264206561726C7921222C2253746172744E6F74696669636174696F6E223A224865616C204472616674204368616C6C656E67652068617320626567756E2120556E6C6F636B2061206E65772063617264206561726C7921222C22456E644E6F74696669636174696F6E223A224865616C204472616674204368616C6C656E676520656E647320696E2074776F20686F75727321204C617374206368616E636520746F20756E6C6F636B2074686973206E65772063617264206561726C7921222C224D696C6573746F6E65486967686C69676874496E5549223A31327D25000000155072696E63652043617264204368616C6C656E676502B09582900BB0DB8C900BB09582900B0000000000000000000000155072696E63652043617264204368616C6C656E67650000036C7B2247616D654D6F6465223A224361726452656C656173654472616674222C225469746C65223A225072696E63652043617264204368616C6C656E6765222C224A6F696E436F7374223A31302C224A6F696E436F73745265736F75726365223A2247656D73222C224D61784C6F73736573223A332C2252657761726473223A5B7B22476F6C64223A3133302C224361726473223A327D2C7B22476F6C64223A3138302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A312C225370656C6C223A225072696E6365227D2C224361726473223A337D2C7B22476F6C64223A3234302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A312C225370656C6C223A225072696E6365227D2C224361726473223A357D2C7B22476F6C64223A3331302C224D696C6573746F6E65223A7B2254797065223A225370656C6C222C22416D6F756E74223A312C225370656C6C223A225072696E6365227D2C224361726473223A387D5D2C2249636F6E4578706F72744E616D65223A2269636F6E5F746F75726E616D656E745F636172645F72656C65617365222C2257696E49636F6E4578706F72744E616D65223A22746F75726E616D656E745F6F70656E5F77696E735F62616467655F6472616674222C224172656E61223A22416C6C222C224D696C6573746F6E65486967686C69676874496E5549223A332C225375627469746C65223A2257696E205072696E636521222C224465736372697074696F6E223A2257696E205072696E6365206361726473207468726F756768206F6E652074696D65207265776172647320616E6420636F6D706C65746520746869732043617264204368616C6C656E676520617420332077696E7321222C2253746172744E6F74696669636174696F6E223A22506C6179203234682043617264204368616C6C656E676520616E6420636865636B207468652053686F7020666F72206361726420737461636B7321222C22456E644E6F74696669636174696F6E223A2254776F20686F757273206C65667420746F20706C61792043617264204368616C6C656E676520616E642067657420746865206361726420737461636B732066726F6D207468652073686F7021222C22436172645468656D65223A225072696E6365222C224672656550617373223A307D26000000125072696E636520537461636B204F6666657201B09582900BB0DB8C900BB09582900B0000000000000000000000125072696E636520537461636B204F666665720000025C7B225469746C65223A225072696E6365204F6666657221222C225375627469746C65223A2254686973206C696D69746564206F666665722069732061204F4E452074696D6520707572636861736521222C2253686F704F6666657273223A5B7B2252657761726473223A5B7B2254797065223A227370656C6C222C22416D6F756E74223A332C225370656C6C223A225072696E6365227D5D2C22496D616765223A7B2250617468223A225C2F6530663565326665333330626665353562386238636434306461626236313162222C22436865636B73756D223A226530663565326665333330626665353562386238636434306461626236313162222C2246696C65223A2273686F705F7072696E63655F737461636B5F30312E706E67227D2C22436F737454797065223A2267656D73222C22436F7374223A3230302C2254656D706C617465223A2273686F705F6974656D325F6E6F5F74657874227D2C7B2252657761726473223A5B7B2254797065223A227370656C6C222C22416D6F756E74223A362C225370656C6C223A225072696E6365227D5D2C22496D616765223A7B2250617468223A225C2F3535326435383464393030356462346266383737353637623536306533666263222C22436865636B73756D223A223535326435383464393030356462346266383737353637623536306533666263222C2246696C65223A2273686F705F7072696E63655F737461636B5F30322E706E67227D2C22436F737454797065223A2267656D73222C22436F7374223A3338302C2254656D706C617465223A2273686F705F6974656D325F6E6F5F74657874227D5D7D0000000000007F0000000522012301240125012605000000487B224944223A22434152445F52454C45415345222C22506172616D73223A7B22417373617373696E223A223230313730333234222C224865616C223A223230313730353031227D7D");

                #endregion

                //_Packet.AddVInt(0);
                //_Packet.AddVInt(4);

                //_Packet.AddRange(this.Chests.ToBytes());

                _Packet.AddHexa("00040113030009060000"); // Chest 1

                _Packet.AddHexa("00041303000B060100000080942380942393E98C900B00007F0113070102007F0000000000000000000000000000B8E3D10184F7D201B9C695900BB8E3D10184F7D201B9C695900B"); // Chest 2

                //_Packet.AddVInt(287600);
                //_Packet.AddVInt(288000);

                //_Packet.AddVInt(TimeStamp);

                _Packet.AddVInt(0);
                _Packet.AddVInt(0);
                _Packet.AddVInt(0);
                _Packet.AddVInt(127);

                _Packet.AddVInt(1); // 0 = Tuto Upgrade Spell

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);

                _Packet.AddVInt(2); // 0, 1 = Animation Page Card (Tuto)

                _Packet.AddVInt(this.Player.Level); // Old Level

                _Packet.AddVInt(55);

                _Packet.AddVInt(this.Player.Arena); // Old Arena

                _Packet.AddHexa("DDCEA7DB0E0505B0B9B601B0B9");

                _Packet.AddVInt(TimeStamp);

                // 3 - Normal
                // 6 - Epic (Has to be Sunday for this to work?) // Simons answer: YES

                _Packet.AddVInt(3);

                _Packet.AddHexa("018201020000000000001A0100018201020000000000001C0001018201020000000000001A0702");

                _Packet.AddVInt(0);

                _Packet.AddVInt(0);
                _Packet.AddVInt(0);
                _Packet.AddVInt(127);

                _Packet.AddVInt(0);
                _Packet.AddVInt(0);
                _Packet.AddVInt(127);

                _Packet.AddVInt(0);
                _Packet.AddVInt(0);
                _Packet.AddVInt(127);

                _Packet.AddHexa("00000000000000000000000900000000F80101000001000000020000010000000E000001000000820100000100000081010000010000000400000100000001AEEAE51801AEEAE5180000000001B0F3B6900B000001018AE6BF3300000000000000");

                return _Packet.ToArray();
            }
        }
    }
}
